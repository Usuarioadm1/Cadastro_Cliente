<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerenciamento de Dados</title>
<style>

@import url('https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap');

body {
    font-family: "Montserrat", sans-serif;
    background-color: #f0f0f0;
    margin: 0;
    padding-top: 0;
    padding-inline: 15%;
    justify-content: center;
    align-items: center;
    text-align: center;
    height: 100vh;
}

/* Novo estilo para o campo oculto */
#hidden-section {
    display: none;
    background: #fff;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    margin-top: 20px;
}

#hidden-section input {
    margin-bottom: 10px;
}

/* Estilo básico dos modais */
.modal {
    display: none; /* Esconder os modais por padrão */
    position: fixed; /* Ficar fixo na tela */
    z-index: 1000; /* Ficar sobre outros elementos, aumentar se necessário */
    left: 0;
    top: 0;
    width: 100%; /* Largura total */
    height: 100%; /* Altura total */
    overflow: auto; /* Permitir rolagem se necessário */
    background-color: rgba(0,0,0,0.4); /* Fundo preto transparente */
    display: flex; /* Usar flexbox para centralizar o conteúdo */
    align-items: center; /* Alinhar verticalmente */
    justify-content: center; /* Alinhar horizontalmente */
}

/* Conteúdo do modal */
.modal-content {
    background-color: #fefefe;
    margin: 15px; /* Margem ao redor do conteúdo */
    padding: 20px;
    border: 1px solid #888;
    width: 80%; /* Largura do modal, ajuste conforme necessário */
    max-width: 500px; /* Largura máxima do modal */
    box-shadow: 0 4px 8px rgba(0,0,0,0.2); /* Sombra para destaque */
    border-radius: 8px; /* Bordas arredondadas */
}

/* Botão de fechar */
.close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
}

.close:hover,
.close:focus {
    color: black;
    text-decoration: none;
    cursor: pointer;
}

/* Classe para esconder o modal */
.hidden {
    display: none;
}

input, select {
    font-size: 15px;
}

/* Estilo do formulário */
#data-form {
    background: #fff;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    width: 100%;
    max-width: 800px;
}

h2 {
    margin-top: 0;
    color: #333;
}

.form-group {
    margin-bottom: 15px;
}

/* Estilo para input e select */
.form-group input, 
.form-group select {
    width: 100%;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 4px;
    box-sizing: border-box;
    appearance: none; /* Remove estilo padrão do navegador */
    -webkit-appearance: none;
    -moz-appearance: none;
    background-color: #fff;
    background-image: url('data:image/svg+xml;charset=US-ASCII,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 4 5"><path fill="gray" d="M2 0L0 2h4L2 0z"/></svg>');
    background-repeat: no-repeat;
    background-position: right 10px top 50%;
    background-size: 12px 12px;
}

/* Foco nos campos */
.form-group input:focus,
.form-group select:focus {
    border-color: #007BFF;
    outline: none;
}

/* Dependentes */
#dependentes {
    margin-top: 20px;
}

.dependente {
    display: none;
    margin-top: 10px;
    padding-top: 10px;
    border-top: 1px solid #ddd;
}

/* Estilo para campos de data */
.form-group input[type="date"] {
    padding: 10px;
}

/* Estilo para o botão */
button {
    background-color: #007BFF;
    color: white;
    border: none;
    padding: 10px 15px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 16px;
    margin-top: 10px;
}

button:hover {
    background-color: #0056b3;
}

/* Ocultar elementos */
.hidden {
    display: none;
}

        body {
	
  font-family: "Montserrat", sans-serif;
            background-color: #f0f0f0;
            padding-inline: 15%;
        }
        .section {
            display: none;
        }
        .active {
            display: block;
        }
        .card {
            background-color: white;
            border: 1px solid #ccc;
            padding: 16px;
            margin-bottom: 10px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        .card h3 {
            margin-top: 0;
        }
    .card p{
            font-size: 18px;
	}
        button {
            background-color: #007BFF;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 10px;
        }

    .botao-cancelar {
      background-color: red;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 10px;
    }


    .botao-cancelar:hover {
      background-color: darkred;
    }

        #data-container {
            flex-wrap: wrap;
            gap: 16px;
        }
        



/* Estilizando o formulário de filtros */
#filter-section {
    background-color: #f9f9f9;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    max-width: 400px;
    margin: 0 auto;
}

#filter-section h2 {
    font-size: 24px;
    color: #333;
    margin-bottom: 15px;
}

/* Estilo para as labels */
#filter-form label {
    font-size: 14px;
    color: #555;
    margin-bottom: 5px;
}

/* Estilizando os inputs e selects para serem menores */
#filter-form input,
#filter-form select {
    width: 100%;
    padding: 6px;
    margin-bottom: 10px;
    border: 1px solid #ccc;
    border-radius: 4px;
    font-size: 14px;
display: block;
}


#nome-cpf-container,
#acomodacao-status-container 
{
    display: flex;
    justify-content: space-between;
}

#nome-filter,
#cpf-filter,
#acomodacao-filter,
#status-filter{
}


	
</style>
	
</head>
<body>

        <div id="cards-section" class="cards-section">
        	<h1>Lista dos Clientes</h1>
        </div>
        <div id="form-section" class="form-section hidden">
       	 <h1>Formulário de Dados</h1>
        </div>

        
    <!--Botões -->
    <button id="reload-button" class="cards-section" onclick="fetchData()">Recarregar Dados</button>
    <button class="form-section hidden"  onclick="showSection('cards-section')">Visualizar Dados</button>
    <button onclick="showSection('form-section')">Criar Novo</button>


    <!-- Seção dos Blocos de Dados -->
	<br/>
	<br/>
        <div id="cards-section" class="cards-section">
<!-- Formulário de Filtros -->
<!-- Formulário de Filtros -->
<div id="filter-section" class="filter-section">
    <h2>Filtros</h2>
    <form id="filter-form">
        <div id="filter-container">
            <div>
                <label for="nome-filter">Nome:</label>
                <input type="text" id="nome-filter" name="nome">
            </div>
            <div>
                <label for="cpf-filter">CPF:</label>
                <input type="text" id="cpf-filter" name="cpf">
            </div>
            <div>
                <label for="acomodacao-filter">Acomodação:</label>
                <select id="acomodacao-filter" name="acomodacao">
                    <option value="">Selecione</option>
                    <option value="Enfermaria">Enfermaria</option>
                    <option value="Apartamento">Apartamento</option>
                    <option value="Especial">Especial</option>
                </select>
            </div>
            <div>
                <label for="status-filter">Status:</label>
                <select id="status-filter" name="status">
                    <option value="">Selecione</option>
                    <option value="ATIVO">Ativo</option>
                    <option value="CANCELADO">Cancelado</option>
                </select>
            </div>
        </div>
        <button type="submit">Aplicar Filtros</button>
    </form>
</div>




	<br/>
	<br/>
            <div id="data-container"></div>
        </div>


    <!-- Seção do formulario -->
        <div id="form-section" class="form-section hidden">
	<br/>
	<br/>

    <form id="data-form">
        <!-- Dados do cliente -->
        <div class="form-group">
            <input type="hidden" id="idPrincipal">
<h3>Dados do titular</h3>
<div class="form-group">
    <input type="text" id="nome" placeholder="Nome" required>
</div>
<div class="form-group">
    <input type="text" id="cpf" placeholder="CPF" required oninput="formatarCPF(this)">
</div>
<div class="form-group">
    <input type="date" id="data_nasc" placeholder="Data de Nascimento" required>
</div>
<div class="form-group">
    <select id="sexo" required>
        <option value="" disabled selected>Selecione o Sexo</option>
        <option value="Feminino">Feminino</option>
        <option value="Masculino">Masculino</option>
    </select>
</div>
<div class="form-group">
    <input type="text" id="identidade" placeholder="Identidade" required>
</div>
<div class="form-group">
    <input type="text" id="org_expedidor" placeholder="Órgão Expedidor" required>
</div>
<div class="form-group">
    <input type="text" id="cns" placeholder="CNS" required>
</div>
<div class="form-group">
    <input type="text" id="nome_mae" placeholder="Nome da Mãe" required>
</div>
<div class="form-group">
    <input type="text" id="nome_pai" placeholder="Nome do Pai" required>
</div>
<div class="form-group">
    <input type="text" id="estado_civil" placeholder="Estado Civil" required>
</div>
<div class="form-group">
    <h3>Informações do plano</h3>
    <input type="text" id="acomodacao" placeholder="Acomodação" required>
</div>
<div class="form-group">
    <input type="text" id="valor_titular" placeholder="Valor Titular" required oninput="formatarMoeda(this)">
</div>

<div class="form-group">
    <h3>Informações de endereço</h3>
    <input type="email" id="email" placeholder="Email" required onblur="validarEmail(this)">
</div>
<div class="form-group">
    <input type="tel" id="telefone" placeholder="Telefone" required oninput="formatarTelefone(this)">
</div>
<div class="form-group">
    <input type="text" id="endereco" placeholder="Endereço" required>
</div>
<div class="form-group">
    <input type="number" id="numero" placeholder="Número" required>
</div>
<div class="form-group">
    <input type="text" id="bairro" placeholder="Bairro" required>
</div>
<div class="form-group">
    <input type="text" id="cidade" placeholder="Cidade" required>
</div>
<div class="form-group">
    <input type="text" id="uf" placeholder="UF" required>
</div>
<div class="form-group">
    <input type="text" id="cep" placeholder="CEP" required>
</div>
<div class="form-group">
    <input type="text" id="complemento" placeholder="Complemento">
</div>

<!-- Campos para Dependentes -->
<div id="dependentes">
    <div class="dependente" id="dependente1">
        <h3>Dependente 1</h3>
        <div class="form-group">
            <input type="text" id="nome_dep1" placeholder="Nome Dependente 1">
        </div>
        <div class="form-group">
            <input type="text" id="cpf_dep1" placeholder="CPF Dependente 1" oninput="formatarCPF(this)">
        </div>
        <div class="form-group">
            <input type="date" id="data_nasc_dep1" placeholder="Data de Nascimento Dependente 1">
        </div>
        <div class="form-group">
            <input type="text" id="nome_mae_dep1" placeholder="Nome da Mãe Dependente 1">
        </div>
        <div class="form-group">
            <input type="text" id="nome_pai_dep1" placeholder="Nome do Pai Dependente 1">
        </div>
        <div class="form-group">
            <input type="text" id="parentesco_dep1" placeholder="Parentesco Dependente 1">
        </div>
        <div class="form-group">
            <input type="text" id="estado_civil_dep1" placeholder="Estado Civil Dependente 1">
        </div>
        <div class="form-group">
            <select id="sexo_dep1">
                <option value="" disabled selected>Selecione o Sexo</option>
                <option value="Feminino">Feminino</option>
                <option value="Masculino">Masculino</option>
            </select>
        </div>
        <div class="form-group">
            <input type="text" id="identidade_dep1" placeholder="Identidade Dependente 1">
        </div>
        <div class="form-group">
            <input type="text" id="org_emissor_dep1" placeholder="Órgão Emissor Dependente 1">
        </div>
        <div class="form-group">
            <input type="text" id="cns_dep1" placeholder="CNS Dependente 1">
        </div>


<div class="form-group">
    <input type="text" id="valor_dep1" placeholder="Valor Titular" required oninput="formatarMoeda(this)">
</div>

    </div>
</div>


            <!-- Dependente 2 -->
            <div class="dependente" id="dependente2">
                <h3>Dependente 2</h3>
                <div class="form-group">
                    <input type="text" id="nome_dep2" placeholder="Nome Dependente 2">
                </div>
                <div class="form-group">
                    <input type="text" id="cpf_dep2" placeholder="CPF Dependente 2" oninput="formatarCPF(this)">
                </div>
                <div class="form-group">
                    <input type="date" id="data_nasc_dep2" placeholder="Data de Nascimento Dependente 2">
                </div>
                <div class="form-group">
                    <input type="text" id="nome_mae_dep2" placeholder="Nome da Mãe Dependente 2">
                </div>
                <div class="form-group">
                    <input type="text" id="nome_pai_dep2" placeholder="Nome do Pai Dependente 2">
                </div>
                <div class="form-group">
                    <input type="text" id="parentesco_dep2" placeholder="Parentesco Dependente 2">
                </div>
                <div class="form-group">
                    <input type="text" id="estado_civil_dep2" placeholder="Estado Civil Dependente 2">
                </div>
        <div class="form-group">
            <select id="sexo_dep2">
                <option value="" disabled selected>Selecione o Sexo</option>
                <option value="Feminino">Feminino</option>
                <option value="Masculino">Masculino</option>
            </select>
         </div>
                <div class="form-group">
                    <input type="text" id="identidade_dep2" placeholder="Identidade Dependente 2">
                </div>
                                <div class="form-group">
                    <input type="text" id="org_emissor_dep2" placeholder="Órgão Emissor Dependente 2">
                </div>
                <div class="form-group">
                    <input type="text" id="cns_dep2" placeholder="CNS Dependente 2">
                </div>
<div class="form-group">
    <input type="text" id="valor_dep2" placeholder="Valor Titular" required oninput="formatarMoeda(this)">
</div>
            </div>

            <!-- Dependente 3 -->
            <div class="dependente" id="dependente3">
                <h3>Dependente 3</h3>
                <div class="form-group">
                    <input type="text" id="nome_dep3" placeholder="Nome Dependente 3">
                </div>
                <div class="form-group">
                    <input type="text" id="cpf_dep3" placeholder="CPF Dependente 3" oninput="formatarCPF(this)">
                </div>
                <div class="form-group">
                    <input type="date" id="data_nasc_dep3" placeholder="Data de Nascimento Dependente 3">
                </div>
                <div class="form-group">
                    <input type="text" id="nome_mae_dep3" placeholder="Nome da Mãe Dependente 3">
                </div>
                <div class="form-group">
                    <input type="text" id="nome_pai_dep3" placeholder="Nome do Pai Dependente 3">
                </div>
                <div class="form-group">
                    <input type="text" id="parentesco_dep3" placeholder="Parentesco Dependente 3">
                </div>
                <div class="form-group">
                    <input type="text" id="estado_civil_dep3" placeholder="Estado Civil Dependente 3">
                </div>
        <div class="form-group">
            <select id="sexo_dep3">
                <option value="" disabled selected>Selecione o Sexo</option>
                <option value="Feminino">Feminino</option>
                <option value="Masculino">Masculino</option>
            </select>
         </div>
                <div class="form-group">
                    <input type="text" id="identidade_dep3" placeholder="Identidade Dependente 3">
                </div>
                <div class="form-group">
                    <input type="text" id="org_emissor_dep3" placeholder="Órgão Emissor Dependente 3">
                </div>
                <div class="form-group">
                    <input type="text" id="cns_dep3" placeholder="CNS Dependente 3">
                </div>
<div class="form-group">
    <input type="text" id="valor_dep3" placeholder="Valor Titular" required oninput="formatarMoeda(this)">
</div>
            </div>

            <!-- Dependente 4 -->
            <div class="dependente" id="dependente4">
                <h3>Dependente 4</h3>
                <div class="form-group">
                    <input type="text" id="nome_dep4" placeholder="Nome Dependente 4">
                </div>
                <div class="form-group">
                    <input type="text" id="cpf_dep4" placeholder="CPF Dependente 4" oninput="formatarCPF(this)">
                </div>
                <div class="form-group">
                    <input type="date" id="data_nasc_dep4" placeholder="Data de Nascimento Dependente 4">
                </div>
                <div class="form-group">
                    <input type="text" id="nome_mae_dep4" placeholder="Nome da Mãe Dependente 4">
                </div>
                <div class="form-group">
                    <input type="text" id="nome_pai_dep4" placeholder="Nome do Pai Dependente 4">
                </div>
                <div class="form-group">
                    <input type="text" id="parentesco_dep4" placeholder="Parentesco Dependente 4">
                </div>
                <div class="form-group">
                    <input type="text" id="estado_civil_dep4" placeholder="Estado Civil Dependente 4">
                </div>
        <div class="form-group">
            <select id="sexo_dep4">
                <option value="" disabled selected>Selecione o Sexo</option>
                <option value="Feminino">Feminino</option>
                <option value="Masculino">Masculino</option>
            </select>
         </div>
                <div class="form-group">
                    <input type="text" id="identidade_dep4" placeholder="Identidade Dependente 4">
                </div>
                <div class="form-group">
                    <input type="text" id="org_emissor_dep4" placeholder="Órgão Emissor Dependente 4">
                </div>
                <div class="form-group">
                    <input type="text" id="cns_dep4" placeholder="CNS Dependente 4">
                </div>
<div class="form-group">
    <input type="text" id="valor_dep4" placeholder="Valor Titular" required oninput="formatarMoeda(this)">
</div>
            </div>

            <!-- Dependente 5 -->
            <div class="dependente" id="dependente5">
                <h3>Dependente 5</h3>
                <div class="form-group">
                    <input type="text" id="nome_dep5" placeholder="Nome Dependente 5">
                </div>
                <div class="form-group">
                    <input type="text" id="cpf_dep5" placeholder="CPF Dependente 5" oninput="formatarCPF(this)">
                </div>
                <div class="form-group">
                    <input type="date" id="data_nasc_dep5" placeholder="Data de Nascimento Dependente 5">
                </div>
                <div class="form-group">
                    <input type="text" id="nome_mae_dep5" placeholder="Nome da Mãe Dependente 5">
                </div>
                <div class="form-group">
                    <input type="text" id="nome_pai_dep5" placeholder="Nome do Pai Dependente 5">
                </div>
                <div class="form-group">
                    <input type="text" id="parentesco_dep5" placeholder="Parentesco Dependente 5">
                </div>
                <div class="form-group">
                    <input type="text" id="estado_civil_dep5" placeholder="Estado Civil Dependente 5">
                </div>
        <div class="form-group">
            <select id="sexo_dep5">
                <option value="" disabled selected>Selecione o Sexo</option>
                <option value="Feminino">Feminino</option>
                <option value="Masculino">Masculino</option>
            </select>
         </div>
                <div class="form-group">
                    <input type="text" id="identidade_dep5" placeholder="Identidade Dependente 5">
                </div>
                <div class="form-group">
                    <input type="text" id="org_emissor_dep5" placeholder="Órgão Emissor Dependente 5">
                </div>
                <div class="form-group">
                    <input type="text" id="cns_dep5" placeholder="CNS Dependente 5">
                </div>
<div class="form-group">
    <input type="text" id="valor_dep5" placeholder="Valor Titular" required oninput="formatarMoeda(this)">
</div>
            </div>
        </div>

        <!-- Botões para adicionar e remover dependentes -->
        <button type="button" id="add-dependente" onclick="addDependente()">Adicionar Dependente</button>
        <button type="button" id="remove-dependente" onclick="removeDependentes()">Remover Dependente</button>
        <br><br/>
        <!-- Campos adicionais -->
        <div class="form-group">
    <h3>Dados adicionais</h3>
            <input type="number" id="valor_tx" placeholder="Valor da taxa">
        </div>
        <div class="form-group">
            <input type="text" id="corretor" placeholder="Corretor">
        </div>
        <div class="form-group">
            <input type="date" id="vigencia" placeholder="Vigência">
        </div>
        <div class="form-group">
            <input type="text" id="operadora" placeholder="Operadora">
        </div>
<button id="submit">Enviar</button>
    </form>

        </div>

	<br/>
	<br/>

    </div>



    <!-- Modal de Dados Sendo Enviados -->
    <div id="modal-enviando" class="modal hidden">
        <div class="modal-content">
            <span class="close" onclick="hideModal('modal-enviando')">&times;</span>
            <p>Dados sendo enviados...</p>
        </div>
    </div>

    <!-- Modal de Dados Enviados com Sucesso -->
    <div id="modal-sucesso" class="modal hidden">
        <div class="modal-content">
            <span class="close" onclick="hideModal('modal-sucesso')">&times;</span>
            <p>Dados enviados com sucesso!</p>
        </div>
    </div>

    <!-- Modal de Buscando Dados -->
    <div id="modal-buscando" class="modal hidden">
        <div class="modal-content">
            <span class="close" onclick="hideModal('modal-buscando')">&times;</span>
            <p>Buscando dados...</p>
        </div>
    </div>

<div id="modal-dados-encontrado" class="modal hidden">
    <div class="modal-content">
        <span class="close" onclick="hideModal('modal-dados-encontrado')">&times;</span>
        <p>Dados encontrados!</p>
    </div>
</div>

<div id="modal-cancelado" class="modal hidden">
    <div class="modal-content">
        <span class="close" onclick="hideModal('modal-cancelado')">&times;</span>
        <p>Cliente cancelado! :)</p>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    fetchData();
});
        let dependenteCount = 0;
        const maxDependentes = 5;

function updateDependenteVisibility() {
    for (let i = 1; i <= maxDependentes; i++) {
        const dependente = document.getElementById(`dependente${i}`);
        if (dependente) {
            if (i <= dependenteCount) {
                // Exibe o campo e torna-o obrigatório
                dependente.style.display = 'block';
                dependente.querySelectorAll('input[required], select[required]').forEach(field => {
                    field.required = true;
                });
            } else {
                // Oculta o campo e torna-o não obrigatório
                dependente.style.display = 'none';
                dependente.querySelectorAll('input[required], select[required]').forEach(field => {
                    field.required = false;
                });
            }
        }
    }

    // Atualiza o botão de adicionar dependente
    document.getElementById('add-dependente').disabled = (dependenteCount >= maxDependentes);
}


        function addDependente() {
            if (dependenteCount < maxDependentes) {
                dependenteCount++;
                updateDependenteVisibility();
            }
        }
	

        function removeDependentes() {
            dependenteCount = dependenteCount - 1;
            updateDependenteVisibility();
        }

        // Initialize
        updateDependenteVisibility();

    // Função para formatar CPF
    function formatarCPF(campo) {
        let cpf = campo.value.replace(/\D/g, '');
        if (cpf.length > 11) cpf = cpf.substring(0, 11);
        campo.value = cpf.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
    }

    // Função para formatar Telefone
    function formatarTelefone(campo) {
        let telefone = campo.value.replace(/\D/g, '');
        if (telefone.length > 11) telefone = telefone.substring(0, 11);
        campo.value = telefone.replace(/(\d{2})(\d{1})(\d{4})(\d{4})/, '$1 $2 $3-$4');
    }

    // Função para validar Email
    function validarEmail(campo) {
        const email = campo.value;
        const regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!regex.test(email)) {
 	
        }
    }

function formatarMoeda(campo) {
    let valor = campo.value;
    valor = valor.replace(/\D/g, "");
    valor = (valor / 100).toFixed(2);
    campo.value = "R$ " + valor.replace('.', ',');
}

const submitButton = document.querySelector("#submit");
submitButton.addEventListener("click", function(event) {
    event.preventDefault();
    const form = document.querySelector("#data-form"); 
    if (form.checkValidity()) {
        handleFormSubmit();
    } else {
        form.reportValidity();
    }
});

        function showSection(sectionClass) {
            document.querySelectorAll('.cards-section').forEach(function(section) {
                section.classList.add('hidden');
            });
            document.querySelectorAll('.form-section').forEach(function(section) {
                section.classList.add('hidden');
            });

            // Mostrar a seção selecionada
            if (sectionClass === 'form-section') {
	limparFormulario()
                document.querySelectorAll('.form-section').forEach(function(section) {
                    section.classList.remove('hidden');
                });
            } else if (sectionClass === 'cards-section') {
                document.querySelectorAll('.cards-section').forEach(function(section) {
                    section.classList.remove('hidden');
                });
            }
        }



function limparFormulario() {
    // Limpar campos do cliente
    document.querySelector('#idPrincipal').value = '';
    document.querySelector('#nome').value = '';
    document.querySelector('#cpf').value = '';
    document.querySelector('#data_nasc').value = '';
    document.querySelector('#sexo').value = '';
    document.querySelector('#identidade').value = '';
    document.querySelector('#org_expedidor').value = '';
    document.querySelector('#cns').value = '';
    document.querySelector('#nome_mae').value = '';
    document.querySelector('#nome_pai').value = '';
    document.querySelector('#estado_civil').value = '';
    document.querySelector('#acomodacao').value = '';
    document.querySelector('#valor_titular').value = '';
    document.querySelector('#email').value = '';
    document.querySelector('#telefone').value = '';
    document.querySelector('#endereco').value = '';
    document.querySelector('#numero').value = '';
    document.querySelector('#bairro').value = '';
    document.querySelector('#cidade').value = '';
    document.querySelector('#uf').value = '';
    document.querySelector('#cep').value = '';
    document.querySelector('#complemento').value = '';
    
    // Limpar campos dos dependentes
    for (let i = 1; i <= 5; i++) {
        document.querySelector(`#nome_dep${i}`).value = '';
        document.querySelector(`#cpf_dep${i}`).value = '';
        document.querySelector(`#data_nasc_dep${i}`).value = '';
        document.querySelector(`#nome_mae_dep${i}`).value = '';
        document.querySelector(`#nome_pai_dep${i}`).value = '';
        document.querySelector(`#parentesco_dep${i}`).value = '';
        document.querySelector(`#estado_civil_dep${i}`).value = '';
        document.querySelector(`#sexo_dep${i}`).value = '';
        document.querySelector(`#identidade_dep${i}`).value = '';
        document.querySelector(`#org_emissor_dep${i}`).value = '';
        document.querySelector(`#cns_dep${i}`).value = '';
        document.querySelector(`#valor_dep${i}`).value = '';
    }

    // Limpar outros campos
    document.querySelector('#valor_tx').value = '';
    document.querySelector('#corretor').value = '';
    document.querySelector('#vigencia').value = '';
    document.querySelector('#operadora').value = '';
}





async function fetchData(filters = {}) {
    try {
        const baseURL = 'https://script.google.com/macros/s/AKfycbx6BapyrViRbesWfb561rVIfVS2b2sXq8z7ZWOVEnp8siOWlTvPlAnPhP0Oc4mzQN7AMg/exec';
        const url = new URL(baseURL);
	showModal('modal-buscando')
        Object.keys(filters).forEach(key => {
            if (filters[key]) {
                url.searchParams.append(key, filters[key]);
            }
        });

        const response = await fetch(url);
        const text = await response.text();

        let data;
        try {
            data = JSON.parse(text);
	hideModal('modal-buscando');
	showModal('modal-dados-encontrado');
        } catch (parseError) {
            console.error('Erro ao converter resposta para JSON:', parseError);
	hideModal('modal-buscando');
            return;
        }

        // Verifica se os dados estão no formato correto
        if (!Array.isArray(data) || data.length === 0) {
            console.error('Nenhum dado encontrado ou formato inválido:', data);
            return;
        }

        let rows;
        // Se houver apenas um conjunto de dados, encapsula em um array
        if (!Array.isArray(data[0])) {
            rows = [data];  // Encapsula o único resultado em um array
        } else {
            const [headers, ...rest] = data;
            rows = rest;
        }

        const container = document.getElementById('data-container');
        container.innerHTML = ''; // Limpa o conteúdo anterior

        // Renderiza os blocos de dados
        rows.forEach((row) => {
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `
                <h3>idPrincipal: ${row[0]}</h3>
                <h3>NOME: ${row[3]}</h3>
                <p>CPF: ${row[4]}</p>
                <p>ACOMODAÇÃO: ${row[13]}</p>
                <p>TELEFONE: ${row[16]}</p>
                <h3>STATUS: ${row[88]}</h3>
                <button onclick="editClient('${row[0]}')">Editar/Visualizar</button>
                <button class="botao-cancelar" onclick="handleCancelarCliente('${row[0]}')">Cancelar</button>
            `;
            container.appendChild(card);
        });
    } catch (error) {
        console.error('Erro ao buscar dados da API:', error);
    }
}



document.getElementById('filter-form').addEventListener('submit', function(event) {
    event.preventDefault(); // Impede o envio do formulário

    // Captura os valores dos filtros
    const nome = document.getElementById('nome-filter').value;
    const cpf = document.getElementById('cpf-filter').value;
    const acomodacao = document.getElementById('acomodacao-filter').value;
    const status = document.getElementById('status-filter').value;

    // Cria um objeto com os filtros
    const filters = {
        nome: nome || undefined,
        cpf: cpf || undefined,
        acomodacao: acomodacao || undefined,
        status: status || undefined
    };

    // Chama a função fetchData com os filtros aplicados
    fetchData(filters);
});



// Função para mostrar o modal
function showModal(id) {
    document.getElementById(id).classList.remove('hidden');
}

// Função para ocultar o modal
function hideModal(id) {
    document.getElementById(id).classList.add('hidden');
}

function handleFormSubmit() {
    // Exibir modal de envio
    showModal('modal-enviando');

    const idPrincipal = document.querySelector('#idPrincipal').value || '';
    const nome = document.querySelector('#nome').value || '';
    const cpf = document.querySelector('#cpf').value || '';
    const dataNasc = document.querySelector('#data_nasc').value || '';
    const sexo = document.querySelector('#sexo').value || '';
    const identidade = document.querySelector('#identidade').value || '';
    const orgExpedidor = document.querySelector('#org_expedidor').value || '';
    const cns = document.querySelector('#cns').value || '';
    const nomeMae = document.querySelector('#nome_mae').value || '';
    const nomePai = document.querySelector('#nome_pai').value || '';
    const estadoCivil = document.querySelector('#estado_civil').value || '';
    const acomodacao = document.querySelector('#acomodacao').value || '';
    const valorTitular = document.querySelector('#valor_titular').value || '';
    const email = document.querySelector('#email').value || '';
    const telefone = document.querySelector('#telefone').value || '';
    const endereco = document.querySelector('#endereco').value || '';
    const numero = document.querySelector('#numero').value || '';
    const bairro = document.querySelector('#bairro').value || '';
    const cidade = document.querySelector('#cidade').value || '';
    const uf = document.querySelector('#uf').value || '';
    const cep = document.querySelector('#cep').value || '';
    const complemento = document.querySelector('#complemento').value || '';
// Captura os dados dos dependentes e mapeia para o formato esperado
const dependentesData = {};
for (let i = 1; i <= 5; i++) {
    dependentesData[`NOME_DEP${i}`] = document.querySelector(`#nome_dep${i}`)?.value || '';
    dependentesData[`CPF_DEP${i}`] = document.querySelector(`#cpf_dep${i}`)?.value || '';
    dependentesData[`DATA_NASC_DEP${i}`] = document.querySelector(`#data_nasc_dep${i}`)?.value || '';
    dependentesData[`NOME_MAE_DEP${i}`] = document.querySelector(`#nome_mae_dep${i}`)?.value || '';
    dependentesData[`NOME_PAI_DEP${i}`] = document.querySelector(`#nome_pai_dep${i}`)?.value || '';
    dependentesData[`PARENTESCO_DEP${i}`] = document.querySelector(`#parentesco_dep${i}`)?.value || '';
    dependentesData[`ESTADO_CIVIL_DEP${i}`] = document.querySelector(`#estado_civil_dep${i}`)?.value || '';
    dependentesData[`SEXO_DEP${i}`] = document.querySelector(`#sexo_dep${i}`)?.value || '';
    dependentesData[`IDENTIDADE_DEP${i}`] = document.querySelector(`#identidade_dep${i}`)?.value || '';
    dependentesData[`ORG_EMISSOR_DEP${i}`] = document.querySelector(`#org_emissor_dep${i}`)?.value || '';
    dependentesData[`CNS_DEP${i}`] = document.querySelector(`#cns_dep${i}`)?.value || '';
    dependentesData[`VALOR_DEP${i}`] = document.querySelector(`#valor_dep${i}`)?.value || '';
}

// Valores de tx, corretor, vigência, operadora e status
const valorTx = document.querySelector('#valor_tx') ? document.querySelector('#valor_tx').value.trim() : '';
const corretor = document.querySelector('#corretor') ? document.querySelector('#corretor').value.trim() : '';
const vigencia = document.querySelector('#vigencia') ? document.querySelector('#vigencia').value.trim() : '';
const operadora = document.querySelector('#operadora') ? document.querySelector('#operadora').value.trim() : '';

// Preenchendo o objeto data com todos os dados
const data = {
    idPrincipal: idPrincipal,
    NOME: nome || '',
    CPF: cpf || '',
    DATA_NASC: dataNasc || '',
    SEXO: sexo || '',
    IDENTIDADE: identidade || '',
    ORG_EXPEDIDOR: orgExpedidor || '',
    CNS: cns || '',
    NOME_MAE: nomeMae || '',
    NOME_PAI: nomePai || '',
    ESTADO_CIVIL: estadoCivil || '',
    ACOMODACAO: acomodacao || '',
    VALOR_TITULAR: valorTitular || '',
    EMAIL: email || '',
    TELEFONE: telefone || '',
    ENDERECO: endereco || '',
    NUMERO: numero || '',
    BAIRRO: bairro || '',
    CIDADE: cidade || '',
    UF: uf || '',
    CEP: cep || '',
    COMPLEMENTO: complemento || '',
    VALOR_TX: valorTx,
    CORRETOR: corretor,
    VIGÊNCIA: vigencia,
    OPERADORA: operadora,
    STATUS: 'ATIVO',
    ...dependentesData
};

    fetch('https://script.google.com/macros/s/AKfycbx6BapyrViRbesWfb561rVIfVS2b2sXq8z7ZWOVEnp8siOWlTvPlAnPhP0Oc4mzQN7AMg/exec', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(data),
        mode: 'no-cors'
    })
    .then(response => response.text())
    .then(result => {
        console.log('Sucesso:', result);
        // Ocultar o modal de envio e exibir o modal de sucesso
        hideModal('modal-enviando');
        showModal('modal-sucesso');
	limparFormulario()
        fetchData();  // Recarrega os dados
    })
    .catch(error => {
        console.error('Erro ao enviar dados:', error);
        // Ocultar o modal de envio e exibir um modal de erro, se necessário
        hideModal('modal-enviando');
        // Exemplo de modal de erro
        alert('Erro ao enviar dados');
    });
}



// Função para editar um cliente pelo ID Histórico e abrir o modal
async function editClient(idPrincipal) {
    showModal('modal-buscando');
    showSection('form-section');
    
    try {
        const response = await fetch(`https://script.google.com/macros/s/AKfycbx6BapyrViRbesWfb561rVIfVS2b2sXq8z7ZWOVEnp8siOWlTvPlAnPhP0Oc4mzQN7AMg/exec?idPrincipal=${idPrincipal}`);
        const data = await response.json();
        
        if (data.length > 1) {
            console.log("Dados encontrados!");
            hideModal('modal-buscando');
            const headers = data[0];
            const clientData = data[1];

            // Preencher o formulário com os dados do cliente
            document.querySelector('#idPrincipal').value = clientData[headers.indexOf('idPrincipal')] || '';
            document.querySelector('#nome').value = clientData[headers.indexOf('NOME')] || '';
            document.querySelector('#cpf').value = clientData[headers.indexOf('CPF')] || '';
            document.querySelector('#data_nasc').value = clientData[headers.indexOf('DATA_NASC')] 
                ? new Date(clientData[headers.indexOf('DATA_NASC')]).toISOString().split('T')[0] 
                : '';
            document.querySelector('#sexo').value = clientData[headers.indexOf('SEXO')] || '';
            document.querySelector('#identidade').value = clientData[headers.indexOf('IDENTIDADE')] || '';
            document.querySelector('#org_expedidor').value = clientData[headers.indexOf('ORG_EXPEDIDOR')] || '';
            document.querySelector('#cns').value = clientData[headers.indexOf('CNS')] || '';
            document.querySelector('#nome_mae').value = clientData[headers.indexOf('NOME_MAE')] || '';
            document.querySelector('#nome_pai').value = clientData[headers.indexOf('NOME_PAI')] || '';
            document.querySelector('#estado_civil').value = clientData[headers.indexOf('ESTADO_CIVIL')] || '';
            document.querySelector('#acomodacao').value = clientData[headers.indexOf('ACOMODACAO')] || '';
            document.querySelector('#valor_titular').value = clientData[headers.indexOf('VALOR_TITULAR')] || '';
            document.querySelector('#email').value = clientData[headers.indexOf('EMAIL')] || '';
            document.querySelector('#telefone').value = clientData[headers.indexOf('TELEFONE')] || '';
            document.querySelector('#endereco').value = clientData[headers.indexOf('ENDERECO')] || '';
            document.querySelector('#numero').value = clientData[headers.indexOf('NUMERO')] || '';
            document.querySelector('#bairro').value = clientData[headers.indexOf('BAIRRO')] || '';
            document.querySelector('#cidade').value = clientData[headers.indexOf('CIDADE')] || '';
            document.querySelector('#uf').value = clientData[headers.indexOf('UF')] || '';
            document.querySelector('#cep').value = clientData[headers.indexOf('CEP')] || '';
            document.querySelector('#complemento').value = clientData[headers.indexOf('COMPLEMENTO')] || '';

            // Dependentes
            for (let i = 1; i <= 5; i++) {
                document.querySelector(`#nome_dep${i}`).value = clientData[headers.indexOf(`NOME_DEP${i}`)] || '';
                document.querySelector(`#cpf_dep${i}`).value = clientData[headers.indexOf(`CPF_DEP${i}`)] || '';
                document.querySelector(`#data_nasc_dep${i}`).value = clientData[headers.indexOf(`DATA_NASC_DEP${i}`)]
                    ? new Date(clientData[headers.indexOf(`DATA_NASC_DEP${i}`)]).toISOString().split('T')[0]
                    : '';
                document.querySelector(`#nome_mae_dep${i}`).value = clientData[headers.indexOf(`NOME_MAE_DEP${i}`)] || '';
                document.querySelector(`#nome_pai_dep${i}`).value = clientData[headers.indexOf(`NOME_PAI_DEP${i}`)] || '';
                document.querySelector(`#parentesco_dep${i}`).value = clientData[headers.indexOf(`PARENTESCO_DEP${i}`)] || '';
                document.querySelector(`#estado_civil_dep${i}`).value = clientData[headers.indexOf(`ESTADO_CIVIL_DEP${i}`)] || '';
                document.querySelector(`#sexo_dep${i}`).value = clientData[headers.indexOf(`SEXO_DEP${i}`)] || '';
                document.querySelector(`#identidade_dep${i}`).value = clientData[headers.indexOf(`IDENTIDADE_DEP${i}`)] || '';
                document.querySelector(`#org_emissor_dep${i}`).value = clientData[headers.indexOf(`ORG_EMISSOR_DEP${i}`)] || '';
                document.querySelector(`#cns_dep${i}`).value = clientData[headers.indexOf(`CNS_DEP${i}`)] || '';
                document.querySelector(`#valor_dep${i}`).value = clientData[headers.indexOf(`VALOR_DEP${i}`)] || '';
            }

            document.querySelector('#valor_tx').value = clientData[headers.indexOf('VALOR_TX')] || '';
            document.querySelector('#corretor').value = clientData[headers.indexOf('CORRETOR')] || '';
            document.querySelector('#vigencia').value = clientData[headers.indexOf('VIGÊNCIA')] 
                ? new Date(clientData[headers.indexOf('VIGÊNCIA')]).toISOString().split('T')[0] 
                : '';
            document.querySelector('#operadora').value = clientData[headers.indexOf('OPERADORA')] || '';
            
            showModal('modal-dados-encontrado');
        } else {
            console.error('Erro:', data.message);
            hideModal('modal-buscando');
        }
    } catch (error) {
        console.error('Erro ao buscar dados da API:', error);
        hideModal('modal-buscando');
    }
}
	// Função para abrir o modal
	function openModal() {
	    const modal = document.getElementById('modal-sucesso');
	    if (modal) {
	        modal.classList.remove('hidden'); // Usar classes para mostrar o modal
    } else {
        console.error('Elemento com ID "modal-sucesso" não encontrado');
    }
}

// Função para fechar o modal
function hideModal(modalId) {
    const modal = document.getElementById(modalId);
    if (modal) {
        modal.classList.add('hidden'); // Usar classes para esconder o modal
    } else {
        console.error('Elemento com ID "' + modalId + '" não encontrado');
    }
}


async function handleCancelarCliente(idPrincipal) {
    try {
        
        // Faz a requisição GET para buscar os dados do cliente
        const response = await fetch(`https://script.google.com/macros/s/AKfycbx6BapyrViRbesWfb561rVIfVS2b2sXq8z7ZWOVEnp8siOWlTvPlAnPhP0Oc4mzQN7AMg/exec?idPrincipal=${idPrincipal}`);
        const data = await response.json();
        if (data.length > 1) {

            const headers = data[0];
            const clientData = data[1];

// Preenchendo as variáveis com os dados do cliente
const idPrincipalValue = clientData[headers.indexOf('idPrincipal')] || '';
const nomeValue = clientData[headers.indexOf('NOME')] || '';
const cpfValue = clientData[headers.indexOf('CPF')] || '';
const dataNascValue = clientData[headers.indexOf('DATA_NASC')] || '';
const sexoValue = clientData[headers.indexOf('SEXO')] || '';
const identidadeValue = clientData[headers.indexOf('IDENTIDADE')] || '';
const orgExpedidorValue = clientData[headers.indexOf('ORG_EXPEDIDOR')] || '';
const cnsValue = clientData[headers.indexOf('CNS')] || '';
const nomeMaeValue = clientData[headers.indexOf('NOME_MAE')] || '';
const nomePaiValue = clientData[headers.indexOf('NOME_PAI')] || '';
const estadoCivilValue = clientData[headers.indexOf('ESTADO_CIVIL')] || '';
const acomodacaoValue = clientData[headers.indexOf('ACOMODACAO')] || '';
const valorTitularValue = clientData[headers.indexOf('VALOR_TITULAR')] || '';
const emailValue = clientData[headers.indexOf('EMAIL')] || '';
const telefoneValue = clientData[headers.indexOf('TELEFONE')] || '';
const enderecoValue = clientData[headers.indexOf('ENDERECO')] || '';
const numeroValue = clientData[headers.indexOf('NUMERO')] || '';
const bairroValue = clientData[headers.indexOf('BAIRRO')] || '';
const cidadeValue = clientData[headers.indexOf('CIDADE')] || '';
const ufValue = clientData[headers.indexOf('UF')] || '';
const cepValue = clientData[headers.indexOf('CEP')] || '';
const complementoValue = clientData[headers.indexOf('COMPLEMENTO')] || '';

// Captura os dados dos dependentes e mapeia para o formato esperado
const dependentesData = {};
for (let i = 1; i <= 5; i++) {
    dependentesData[`NOME_DEP${i}`] = clientData[headers.indexOf(`NOME_DEP${i}`)] || '';
    dependentesData[`CPF_DEP${i}`] = clientData[headers.indexOf(`CPF_DEP${i}`)] || '';
    dependentesData[`DATA_NASC_DEP${i}`] = clientData[headers.indexOf(`DATA_NASC_DEP${i}`)] || '';
    dependentesData[`NOME_MAE_DEP${i}`] = clientData[headers.indexOf(`NOME_MAE_DEP${i}`)] || '';
    dependentesData[`NOME_PAI_DEP${i}`] = clientData[headers.indexOf(`NOME_PAI_DEP${i}`)] || '';
    dependentesData[`PARENTESCO_DEP${i}`] = clientData[headers.indexOf(`PARENTESCO_DEP${i}`)] || '';
    dependentesData[`ESTADO_CIVIL_DEP${i}`] = clientData[headers.indexOf(`ESTADO_CIVIL_DEP${i}`)] || '';
    dependentesData[`SEXO_DEP${i}`] = clientData[headers.indexOf(`SEXO_DEP${i}`)] || '';
    dependentesData[`IDENTIDADE_DEP${i}`] = clientData[headers.indexOf(`IDENTIDADE_DEP${i}`)] || '';
    dependentesData[`ORG_EMISSOR_DEP${i}`] = clientData[headers.indexOf(`ORG_EMISSOR_DEP${i}`)] || '';
    dependentesData[`CNS_DEP${i}`] = clientData[headers.indexOf(`CNS_DEP${i}`)] || '';
    dependentesData[`VALOR_DEP${i}`] = clientData[headers.indexOf(`VALOR_DEP${i}`)] || '';
}

// Valores de tx, corretor, vigência, operadora
const valorTxValue = clientData[headers.indexOf('VALOR_TX')] || '';
const corretorValue = clientData[headers.indexOf('CORRETOR')] || '';
const vigenciaValue = clientData[headers.indexOf('VIGÊNCIA')] || '';
const operadoraValue = clientData[headers.indexOf('OPERADORA')] || '';

            // Preenchendo o objeto data com todos os dados
            const dataToSend = {
                idPrincipal: idPrincipalValue,
                NOME: nomeValue,
                CPF: cpfValue,
                DATA_NASC: dataNascValue,
                SEXO: sexoValue,
                IDENTIDADE: identidadeValue,
                ORG_EXPEDIDOR: orgExpedidorValue,
                CNS: cnsValue,
                NOME_MAE: nomeMaeValue,
                NOME_PAI: nomePaiValue,
                ESTADO_CIVIL: estadoCivilValue,
                ACOMODACAO: acomodacaoValue,
                VALOR_TITULAR: valorTitularValue,
                EMAIL: emailValue,
                TELEFONE: telefoneValue,
                ENDERECO: enderecoValue,
                NUMERO: numeroValue,
                BAIRRO: bairroValue,
                CIDADE: cidadeValue,
                UF: ufValue,
                CEP: cepValue,
                COMPLEMENTO: complementoValue,
                VALOR_TX: valorTxValue,
                CORRETOR: corretorValue,
                VIGÊNCIA: vigenciaValue,
                OPERADORA: operadoraValue,
                STATUS: 'CANCELADO',
                ...dependentesData
            };
	
           const confirmacao = true

            if (confirmacao) {
                fetch('https://script.google.com/macros/s/AKfycbx6BapyrViRbesWfb561rVIfVS2b2sXq8z7ZWOVEnp8siOWlTvPlAnPhP0Oc4mzQN7AMg/exec', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(dataToSend),
                    mode: 'no-cors'
                })
                .then(response => response.text())
                .then(result => {
                    hideModal('modal-enviando');
                    showModal('modal-cancelado');
                    limparFormulario();
                    fetchData(); 
                })
                .catch(error => {
                    console.error('Erro ao enviar dados:', error);
                    hideModal('modal-enviando');
                    alert('Erro ao enviar dados');
                });
            }
        } else {
            console.log("Nenhum dado encontrado para o cliente com este id: ", idPrincipal);
            hideModal('modal-buscando');
            alert('Nenhum dado encontrado para o cliente.');
        }
    } catch (error) {
        console.error('Erro ao buscar dados:', error);
        hideModal('modal-buscando');
        alert('Erro ao buscar dados');
    }
}
 
    </script>
</body>
</html>